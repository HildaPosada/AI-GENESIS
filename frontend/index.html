<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Fraud Detection - Protect Your Business</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .hover-lift {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse-glow {
            animation: pulseGlow 2s infinite;
        }
        
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(102, 126, 234, 0.4); }
            50% { box-shadow: 0 0 30px rgba(102, 126, 234, 0.7); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 min-h-screen text-white">
    <div x-data="fraudDetectionApp()" x-init="init()" class="min-h-screen">
        <!-- Header -->
        <header class="bg-gradient-to-r from-blue-900 to-purple-900 shadow-lg">
            <div class="container mx-auto px-6 py-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold">üõ°Ô∏è AI Fraud Detection System</h1>
                        <p class="text-blue-200 mt-1">AI Genesis Hackathon 2025 - Powered by 4 AI Technologies</p>
                    </div>
                    <div class="flex gap-4">
                        <div class="text-right">
                            <div class="text-sm text-blue-200">API Status</div>
                            <div class="flex items-center gap-2 mt-1">
                                <div :class="apiStatus === 'healthy' ? 'bg-green-500' : 'bg-red-500'" class="w-3 h-3 rounded-full animate-pulse"></div>
                                <span x-text="apiStatus" class="font-semibold capitalize"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Technology Stack Banner -->
        <div class="bg-gradient-to-r from-purple-800 to-pink-800 py-4">
            <div class="container mx-auto px-6">
                <div class="grid grid-cols-4 gap-4 text-center">
                    <div class="flex flex-col items-center">
                        <i class="fas fa-brain text-3xl mb-2"></i>
                        <div class="font-semibold">Google Gemini</div>
                        <div class="text-xs text-purple-200">Multimodal AI</div>
                    </div>
                    <div class="flex flex-col items-center">
                        <i class="fas fa-cogs text-3xl mb-2"></i>
                        <div class="font-semibold">Opus</div>
                        <div class="text-xs text-purple-200">Workflow Automation</div>
                    </div>
                    <div class="flex flex-col items-center">
                        <i class="fas fa-search text-3xl mb-2"></i>
                        <div class="font-semibold">Qdrant</div>
                        <div class="text-xs text-purple-200">Vector Search</div>
                    </div>
                    <div class="flex flex-col items-center">
                        <i class="fas fa-robot text-3xl mb-2"></i>
                        <div class="font-semibold">AI/ML API</div>
                        <div class="text-xs text-purple-200">100+ Models</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="container mx-auto px-6 py-8">
            <!-- Tabs -->
            <div class="flex gap-4 mb-8 border-b border-gray-700">
                <button @click="activeTab = 'transaction'" :class="activeTab === 'transaction' ? 'border-blue-500 text-blue-500' : 'border-transparent'" class="px-6 py-3 border-b-2 font-semibold transition">
                    <i class="fas fa-credit-card mr-2"></i>Transaction Analysis
                </button>
                <button @click="activeTab = 'document'" :class="activeTab === 'document' ? 'border-blue-500 text-blue-500' : 'border-transparent'" class="px-6 py-3 border-b-2 font-semibold transition">
                    <i class="fas fa-file-alt mr-2"></i>Document Analysis
                </button>
                <button @click="activeTab = 'workflow'" :class="activeTab === 'workflow' ? 'border-blue-500 text-blue-500' : 'border-transparent'" class="px-6 py-3 border-b-2 font-semibold transition">
                    <i class="fas fa-project-diagram mr-2"></i>Workflows
                </button>
            </div>

            <!-- Transaction Analysis Tab -->
            <div x-show="activeTab === 'transaction'" class="space-y-6">
                <div class="grid grid-cols-3 gap-6">
                    <!-- Input Form -->
                    <div class="col-span-1 bg-gray-800 rounded-lg p-6 shadow-xl">
                        <h2 class="text-xl font-bold mb-4">Generate Sample Transaction</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Transaction Type</label>
                                <select x-model="sampleType" class="w-full px-4 py-2 bg-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                                    <option value="normal">Normal Transaction</option>
                                    <option value="suspicious">Suspicious Transaction</option>
                                    <option value="fraud">Fraudulent Transaction</option>
                                </select>
                            </div>
                            <button @click="generateSampleTransaction()" :disabled="loading" class="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 px-6 py-3 rounded-lg font-semibold transition">
                                <span x-show="!loading">Generate & Analyze</span>
                                <span x-show="loading">Analyzing...</span>
                            </button>
                        </div>
                    </div>

                    <!-- Transaction Details -->
                    <div class="col-span-2 bg-gray-800 rounded-lg p-6 shadow-xl">
                        <h2 class="text-xl font-bold mb-4">Transaction Details</h2>
                        <div x-show="currentTransaction" class="space-y-3">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <div class="text-sm text-gray-400">Transaction ID</div>
                                    <div x-text="currentTransaction?.transaction_id" class="font-mono"></div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-400">Amount</div>
                                    <div class="text-2xl font-bold text-green-400">$<span x-text="currentTransaction?.amount"></span></div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-400">Merchant</div>
                                    <div x-text="currentTransaction?.merchant_name"></div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-400">Location</div>
                                    <div x-text="currentTransaction?.location"></div>
                                </div>
                            </div>
                        </div>
                        <div x-show="!currentTransaction" class="text-center text-gray-500 py-8">
                            Generate a transaction to see details
                        </div>
                    </div>
                </div>

                <!-- Analysis Results -->
                <div x-show="analysisResult" class="bg-gray-800 rounded-lg p-6 shadow-xl">
                    <h2 class="text-2xl font-bold mb-4">
                        <i class="fas fa-shield-alt mr-2"></i>Fraud Analysis Results
                    </h2>

                    <!-- Status Banner -->
                    <div :class="analysisResult?.is_fraudulent ? 'bg-red-900 border-red-500' : 'bg-green-900 border-green-500'" class="border-l-4 p-4 mb-6 rounded">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-2xl font-bold">
                                    <span x-show="analysisResult?.is_fraudulent">‚ö†Ô∏è FRAUD DETECTED</span>
                                    <span x-show="!analysisResult?.is_fraudulent">‚úÖ TRANSACTION APPROVED</span>
                                </div>
                                <div class="mt-1">
                                    Risk Level: <span x-text="analysisResult?.risk_level" class="uppercase font-bold"></span> |
                                    Confidence: <span x-text="(analysisResult?.confidence_score * 100).toFixed(0)"></span>%
                                </div>
                            </div>
                            <div class="text-5xl">
                                <span x-show="analysisResult?.is_fraudulent">üö®</span>
                                <span x-show="!analysisResult?.is_fraudulent">üéâ</span>
                            </div>
                        </div>
                    </div>

                    <!-- Technology Breakdown -->
                    <div class="grid grid-cols-2 gap-6 mb-6">
                        <div class="bg-gray-700 rounded-lg p-4">
                            <h3 class="font-bold mb-3 text-blue-400">
                                <i class="fas fa-brain mr-2"></i>Technology Stack Used
                            </h3>
                            <div class="space-y-2 text-sm">
                                <div x-show="analysisResult?.analysis_details?.technologies_used" x-html="formatTechnologies(analysisResult?.analysis_details?.technologies_used)"></div>
                            </div>
                        </div>
                        <div class="bg-gray-700 rounded-lg p-4">
                            <h3 class="font-bold mb-3 text-yellow-400">
                                <i class="fas fa-exclamation-triangle mr-2"></i>Risk Factors
                            </h3>
                            <ul class="space-y-1 text-sm">
                                <template x-for="reason in analysisResult?.reasons" :key="reason">
                                    <li class="flex items-start">
                                        <span class="mr-2">‚Ä¢</span>
                                        <span x-text="reason"></span>
                                    </li>
                                </template>
                            </ul>
                        </div>
                    </div>

                    <!-- Similar Cases -->
                    <div x-show="analysisResult?.similar_cases?.length > 0" class="bg-gray-700 rounded-lg p-4 mb-6">
                        <h3 class="font-bold mb-3 text-purple-400">
                            <i class="fas fa-search mr-2"></i>Similar Fraud Patterns Found (Qdrant)
                        </h3>
                        <div class="space-y-2">
                            <template x-for="case_ in analysisResult?.similar_cases" :key="case_.pattern_id">
                                <div class="bg-gray-800 p-3 rounded flex justify-between items-center">
                                    <div>
                                        <div class="font-semibold" x-text="case_.description"></div>
                                        <div class="text-sm text-gray-400">
                                            Type: <span x-text="case_.type"></span> |
                                            Severity: <span x-text="case_.severity"></span>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-sm text-gray-400">Similarity</div>
                                        <div class="text-xl font-bold text-blue-400" x-text="(case_.similarity_score * 100).toFixed(0) + '%'"></div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>

                    <!-- Recommended Actions -->
                    <div class="bg-gray-700 rounded-lg p-4">
                        <h3 class="font-bold mb-3 text-red-400">
                            <i class="fas fa-tasks mr-2"></i>Recommended Actions
                        </h3>
                        <ul class="space-y-2">
                            <template x-for="action in analysisResult?.recommended_actions" :key="action">
                                <li class="flex items-center">
                                    <input type="checkbox" class="mr-3 w-5 h-5">
                                    <span x-text="action"></span>
                                </li>
                            </template>
                        </ul>
                    </div>

                    <!-- Workflow Info -->
                    <div x-show="analysisResult?.analysis_details?.workflow" class="bg-gradient-to-r from-purple-900 to-pink-900 rounded-lg p-4 mt-6">
                        <h3 class="font-bold mb-2 text-lg">
                            <i class="fas fa-cogs mr-2"></i>Automated Workflow Created (Opus)
                        </h3>
                        <div class="text-sm">
                            Workflow ID: <span class="font-mono" x-text="analysisResult?.analysis_details?.workflow?.workflow_id"></span>
                        </div>
                        <div class="text-sm mt-1">
                            Status: <span class="font-semibold" x-text="analysisResult?.analysis_details?.workflow?.status"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Document Analysis Tab -->
            <div x-show="activeTab === 'document'" class="bg-gray-800 rounded-lg p-6 shadow-xl">
                <h2 class="text-xl font-bold mb-4">Document Fraud Analysis</h2>
                <div class="text-center py-12 text-gray-400">
                    <i class="fas fa-file-upload text-6xl mb-4"></i>
                    <p>Upload invoices, bank statements, or ID documents</p>
                    <p class="text-sm mt-2">Powered by Google Gemini Vision</p>
                    <button class="mt-4 bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded-lg">
                        Upload Document
                    </button>
                </div>
            </div>

            <!-- Workflow Tab -->
            <div x-show="activeTab === 'workflow'" class="bg-gray-800 rounded-lg p-6 shadow-xl">
                <h2 class="text-xl font-bold mb-4">Investigation Workflows</h2>
                <div class="text-center py-12 text-gray-400">
                    <i class="fas fa-project-diagram text-6xl mb-4"></i>
                    <p>Automated fraud investigation workflows</p>
                    <p class="text-sm mt-2">Powered by Opus Workflow Automation</p>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="bg-gray-800 border-t border-gray-700 mt-12 py-6">
            <div class="container mx-auto px-6 text-center text-gray-400">
                <p>üèÜ Built for AI Genesis Hackathon 2025</p>
                <p class="text-sm mt-2">Integrating Google Gemini, Opus, Qdrant, and AI/ML API</p>
            </div>
        </footer>
    </div>

    <script>
        function fraudDetectionApp() {
            return {
                activeTab: 'transaction',
                apiStatus: 'checking',
                loading: false,
                sampleType: 'normal',
                currentTransaction: null,
                analysisResult: null,

                // Auto-detect API URL for GitHub Codespaces or localhost
                getApiUrl() {
                    // If running in Codespaces, use the forwarded port URL
                    if (window.location.hostname.includes('github.dev') || window.location.hostname.includes('githubpreview.dev')) {
                        // Build the backend URL by replacing the port in hostname
                        const backendHostname = window.location.hostname.replace('-3000.', '-8000.');
                        return `${window.location.protocol}//${backendHostname}`;
                    }
                    // Default to localhost for local development
                    return 'http://localhost:8000';
                },

                async init() {
                    console.log('API URL:', this.getApiUrl());
                    await this.checkHealth();
                },

                async checkHealth() {
                    try {
                        const response = await fetch(`${this.getApiUrl()}/api/health`);
                        const data = await response.json();
                        this.apiStatus = data.status;
                    } catch (error) {
                        this.apiStatus = 'offline';
                        console.error('Health check failed:', error);
                    }
                },

                async generateSampleTransaction() {
                    this.loading = true;
                    this.analysisResult = null;

                    try {
                        // Generate sample transaction
                        const sampleResponse = await fetch(`${this.getApiUrl()}/api/demo/generate-sample-transaction?fraud_type=${this.sampleType}`, {
                            method: 'POST'
                        });
                        this.currentTransaction = await sampleResponse.json();

                        // Analyze transaction
                        const analysisResponse = await fetch(`${this.getApiUrl()}/api/analyze/transaction`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(this.currentTransaction)
                        });
                        this.analysisResult = await analysisResponse.json();

                    } catch (error) {
                        console.error('Analysis failed:', error);
                        alert('Analysis failed. Make sure the backend is running on port 8000.');
                    } finally {
                        this.loading = false;
                    }
                },

                formatTechnologies(tech) {
                    if (!tech) return '';
                    return Object.entries(tech).map(([key, value]) => {
                        const icons = {
                            'google_gemini': 'üß†',
                            'opus': '‚öôÔ∏è',
                            'qdrant': 'üîç',
                            'aiml_api': 'ü§ñ'
                        };
                        return `<div class="mb-1"><strong>${icons[key] || '‚Ä¢'} ${this.formatKey(key)}:</strong> ${value}</div>`;
                    }).join('');
                },

                formatKey(key) {
                    return key.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
                }
            }
        }
    </script>
</body>
</html>
